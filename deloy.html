<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy Product</title>
</head>

<body>
    <h2>Deploy Product</h2>

    <label>Token:</label>
    <input type="text" id="token" placeholder="Enter Bearer Token" style="width: 400px;"><br><br>

    <label>Local Project Path:</label>
    <input type="text" id="localProjectPath"
        value="/media/kali/Новый том1/nodejs/Datagaze/all_in_one/products/dlp"><br><br>

    <label>Server Host:</label>
    <input type="text" id="host" value="ec2-18-215-159-132.compute-1.amazonaws.com"><br><br>

    <label>Port:</label>
    <input type="number" id="port" value="22"><br><br>

    <label>Username:</label>
    <input type="text" id="username" value="ubuntu"><br><br>

    <!-- <label>Auth Type:</label>
    <select id="auth_type">
        <option value="key">Key</option>
        <option value="password">Password</option>
    </select><br><br> -->

    <!-- <label>Password (if using password):</label>
    <input type="password" id="password"><br><br> -->

    <label>Private Key (if using key authentication):</label>
    <textarea id="privateKey" rows="4" cols="50">-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAyCdtLKcRtYv6J0iT+mq90NQNrdTVKhgt1xtFpZfwY4Je156s\n3XZyuHYh1INE6Px29NEnAdofb5SaAZ2Mpo/k87z4XkGrZDM9pQR8Z1yG60PH7aac\ngcA1byCwVkDHu+u0nJdqf42urpQxeZFIPHSbMuSwYlIqtca1NVhe1uT0zgKYKlCM\nA8jaja7DE0Xc8aw7Wp6rBzCF6pwLyxT5Q6bwVOIsmkdWjI/YqQ16A5PMDa+yopJv\nL03ff+9PYRxHZWVhiQjgTkKhh0U6BuPkBv6ygCpY8YIy1Mq/fnLSC7PrDeWLSYyY\nOScWqycm/5DqIVAHKVCNz+FWYLScdyY4aWCvKQIDAQABAoIBAGGcYLDLFWbdSfTI\nf2o7jjB+ieFBj2eE/S4PXcrhK1nMJaav+ovSjSYKbnsuPXgGT5kbOxO7JWOMLAMn\nq4U7XaPEf7ev/P7TwndslaLuy9mGZ8UtYNwiOazlWznlQ8MQszc+3LAyD4OSQAKS\naJEbKOkMAD0i5zNZIdxPKYlRhVXFrvj8SEwefTIoJVB96Tvyp41hKoXOs4k0ooEb\n4Gbcn5abein+JEVS0gArrzQZBHyvv0txBTzVKHqV0Yh8ods3t+ymL0XktmO6xrQb\nTKlQ/1S1nI+sQQSmUCpPm8b7jxgQ6js6VyIGI3F7dFlp9zHjy4lGSzA6CNCwLZLo\nPf7u9tECgYEA7+e7oFKJXXOdISYdyQvQaICdRKPdD4E7Nk/ERn5CnqOQErbMWiwB\nRwJ+h/ZiTVWhM1d9pY7dx8ZfOr7Zm3tKmryP2gbykOco9h4DFX+tdqs4wjqDUMoY\nPwJgI8sYnCEtHThBmnQUivrNrNFFaqG+BKkfKyBVEEF5zB5m6kOW0cUCgYEA1ZT7\n7pSnpSU9YMkw3+hbzsAUgxREk+Fa6LUJ3SkrVYT8dF8BJ78OK3x2Kxc+awZ8gOK+\nVz+c2UZZF7cTlFOxU6//RtpGprV0gV6Y/C3mKXvaAX2dfJtf/J96Wa45v7BqNEiz\nK97/dGQ5vnL31MmUpD3G/wISG9Mc73KpDAJ1MhUCgYAWLft3wAm5HRY62VZJnxD+\niF2B2hB2/YCm7cr8pXGtTvvj7wiHkafwk7d1BH9kHPWRVJZmNwYkER/+w2RE7qog\nEizOgHPul6B+2Jl6ZFp6LSxLMLOxRW3mbWbMCFvXG24bVHckO3UmwDdBsftT924k\n6inah9u1bAhBqdHj+Km57QKBgFu9ULFb3N6Mrl6CTKIAdl7KFoVvET3L0HagPIpo\ngpqLMrzxidd+syFupns/0qm58YSS4FstkbuqAd6z3o8Zm9Nsh2PxoeM9kbt33JKF\nTJWJA00cnabGPmaOQcl/koKJzjSC/aLceDGQU1VAoL8fjt81QeKLCyg0d/tJ7t6f\nt6M5AoGBAL8rWdTeEtpzFPON+MBl5l+rGYG1XIOAENWFYYWNbs2hFLgDi8ESZQtV\n1aW2GG45AYPnjKQNYID13u9QgMY0LWkqr/3Kuedb4/X4fTE75t+Ms7Ng0g2yc8aU\ntYKIZk7vz8JtMocYUMlqmC4ondyjDlGznRePoTUZ7ra0WGHZmXKB\n-----END RSA PRIVATE KEY-----</textarea><br><br>

    <button onclick="deployProduct()">Deploy</button>

    <h3>Deployment Logs:</h3>
    <pre id="logs"
        style="background: #f4f4f4; padding: 10px; border: 1px solid #ddd; width: 600px; height: 300px; overflow-y: scroll;"></pre>

    <script src="https://cdn.jsdelivr.net/npm/event-source-polyfill@1.0.25/src/eventsource.min.js"></script>

    <script>
        async function deployProduct() {
            const token = document.getElementById("token").value;
            const localProjectPath = document.getElementById("localProjectPath").value;
            const host = document.getElementById("host").value;
            const port = document.getElementById("port").value;
            const username = document.getElementById("username").value;
            const privateKey = document.getElementById("privateKey").value.trim();
            const logs = document.getElementById("logs");

            logs.innerHTML = "Starting deployment...\n";

            try {
                const response = await fetch("http://localhost:3000/ssh/deploy-product", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        localProjectPath,
                        serverCredentials: { host, port, username, privateKey }
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    logs.innerHTML += decoder.decode(value) + "\n";
                    logs.scrollTop = logs.scrollHeight;
                }
            } catch (error) {
                logs.innerHTML += "Error: " + error.message + "\n";
            }
        }

    </script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/event-source-polyfill/1.0.25/eventsource.min.js"></script> -->
</body>

</html>